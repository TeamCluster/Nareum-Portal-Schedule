<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>예약 신청</title>
    <style>
        .time-grid {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .time-slot {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: center;
            cursor: pointer;
        }
        .time-slot input {
            display: none; 
        }
        .time-slot.disabled {
            background-color: #eee;
            color: #aaa;
            cursor: not-allowed;
        }
        .time-slot.selected {
            background-color: #aaddff;
        }
        /* 체크박스가 체크되면 텍스트 스타일 변경 */
        .time-slot input:checked + span {
            font-weight: bold;
            color: blue;
        }
    </style>
</head>
<body>
    <h1>예약 신청서</h1>
    <p><strong>시설명:</strong> {{ facility.name }}</p>
    <p><strong>예약 날짜:</strong> {{ selected_date }}</p>

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <ul style="color: red; font-weight: bold;">
        {% for message in messages %}
          <li>{{ message }}</li>
        {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    <form method="post">
        <hr>
        <h2>1. 신청인 정보</h2>
        이름: <input type="text" name="name" value="{{ form_data.name if form_data else '' }}" required><br>
        
        연락처: <input type="text" name="contact" value="{{ form_data.contact if form_data else '' }}" 
               required placeholder="010-0000-0000" pattern="010-[0-9]{4}-[0-9]{4}" 
               title="010-0000-0000 형식으로 입력해주세요"><br>
        
        소속: <input type="text" name="school" value="{{ form_data.school if form_data else '' }}" required><br>
        
        동아리: <input type="text" name="club" value="{{ form_data.club if form_data else '' }}"><br>

        <hr>
        <h2>2. 이용 일정 선택 (시간 선택)</h2>
        <p>이용할 시간대를 모두 선택해주세요 (연속 선택 필수)</p>
        <div class="time-grid">
            {% for h in range(9, 18) %}
                {% if h in booked_hours %}
                    <label class="time-slot disabled">
                        <input type="checkbox" name="time_slot" value="{{ h }}" disabled>
                        <span>{{ h }}:00</span><br>(마감)
                    </label>
                {% else %}
                    <label class="time-slot">
                        <input type="checkbox" name="time_slot" value="{{ h }}" 
                        {% if form_data and h|string in form_data.getlist('time_slot') %}checked{% endif %}>
                        <span>{{ h }}:00</span>
                    </label>
                {% endif %}
            {% endfor %}
        </div>

        <hr>
        <h2>3. 이용 인원</h2>
        초등: <input type="number" name="elementary" value="{{ form_data.elementary if form_data else '0' }}" min="0"><br>
        중등: <input type="number" name="middle" value="{{ form_data.middle if form_data else '0' }}" min="0"><br>
        고등: <input type="number" name="high" value="{{ form_data.high if form_data else '0' }}" min="0"><br>
        후기청소년: <input type="number" name="teen" value="{{ form_data.teen if form_data else '0' }}" min="0"><br>
        성인: <input type="number" name="adult" value="{{ form_data.adult if form_data else '0' }}" min="0"><br>

        <hr>
        <h2>4. 필요 물품</h2>
        {% set equipments = ['앰프', '스피커', '마이크', '키보드'] %}
        {% for item in equipments %}
            <label>
                <input type="checkbox" name="equipment" value="{{ item }}"
                {% if form_data and item in form_data.getlist('equipment') %}checked{% endif %}>
                {{ item }}
            </label>
        {% endfor %}
        <br>

        <hr>
        <h2>5. 공지 및 준수사항</h2>
        <ul>
            <li>대관 시간은 최소 하루 전까지 신청해야 합니다.</li>
            <li>음식물 반입을 금지합니다.</li>
            <li>사용 후 정리정돈은 필수입니다.</li>
        </ul>
        <label>
            <input type="checkbox" id="agree" name="agree" value="1" onchange="toggleSubmit()">
            위 준수사항을 모두 확인했으며, 이에 동의합니다.
        </label><br><br>

        <button id="submitBtn" type="submit" disabled>예약 신청하기</button>
    </form>

    <script>
    function toggleSubmit() {
        const checkbox = document.getElementById("agree");
        const button = document.getElementById("submitBtn");
        button.disabled = !checkbox.checked;
    }
    
    // 페이지 로드 시(에러로 리로드 된 경우 포함) 동의가 체크되어 있으면 버튼 활성화
    window.onload = function() {
        toggleSubmit();
    }
    </script>
</body>
</html>