<h1>{{ SERVICE_NAME }}</h1>

<form id="searchForm" method="get" action="/">
    <label>날짜 선택: 
        <input type="date" name="date" id="dateInput" value="{{ request.args.get('date', '') }}">
    </label>
    <label>시설 선택: 
        <select name="facility_type">
            <option value="전체">전체</option>
            <option value="연습실">연습실</option>
            <option value="회의실">회의실</option>
        </select>
    </label>
    <button type="submit">조회하기</button>
</form>

<hr>

<h2>예약 가능 시설 목록</h2>
{% with messages = get_flashed_messages() %}
  {% if messages %}
    <p style="color:red;">{{ messages[0] }}</p>
  {% endif %}
{% endwith %}

<ul>
    {% for f in facilities %}
    <li style="border:1px solid #ddd; margin:10px; padding:10px;">
        <h3>{{ f.name }} <small>({{ f.type }})</small></h3>
        <p>{{ f.description }}</p>
        
        <form method="get" action="{{ url_for('reserve', facility_id=f.id) }}" onsubmit="return checkDate(this)">
            <input type="hidden" name="date" class="hiddenDate">
            <button type="submit">상세보기 및 예약</button>
        </form>
    </li>
    {% endfor %}
</ul>

<script>
// 페이지 로드 시 오늘 날짜 기본 세팅 (선택 안했을 경우)
window.onload = function() {
    const dateInput = document.getElementById("dateInput");
    if (!dateInput.value) {
        const today = new Date();
        const yyyy = today.getFullYear();
        const mm = String(today.getMonth() + 1).padStart(2, '0');
        const dd = String(today.getDate()).padStart(2, '0');
        // dateInput.value = `${yyyy}-${mm}-${dd}`; // 필요시 주석 해제하여 오늘 날짜 자동 선택
    }
}

function checkDate(form){
    const mainDateInput = document.getElementById("dateInput").value;
    
    if(!mainDateInput){
        alert("상단의 [날짜 선택]에서 예약할 날짜를 먼저 선택해주세요.");
        return false;
    }

    const today = new Date();
    today.setHours(0,0,0,0);
    
    const selected = new Date(mainDateInput);
    if(selected <= today){
        alert("예약 날짜는 내일부터 가능합니다.");
        return false;
    }

    // 폼 내부의 hidden input에 날짜 값 복사
    form.querySelector(".hiddenDate").value = mainDateInput;
    return true;
}
</script>